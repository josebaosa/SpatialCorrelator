 /*
                                        *******************
 ***************************************** C SOURCE FILE ****************************************
 **                                     *******************                                    **
 **                                                                                            **
 ** project    : General template                                                              **
 ** filename   : TPL.H                                                                         **
 ** version    : 0.11                                                                          **
 ** date       : 19/11/2015                                                                    **
 **                                                                                            **
 ************************************************************************************************
 **                                                                                            **
 ** Copyright (c) 2015, Sainz Oruna, Markel                                                    **
 ** All rights reserved.                                                                       **
 **                                                                                            **
 ************************************************************************************************

 VERSION HISTORY:
 -- -- -- -- -- --

 Version     : 0.1
 Date        : 19/11/2015
 Revised by  : Sainz Oruna, Markel
 Description : Original version.

 */

#define state_machine_c

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                MODULES USED                                              **/
 /**                                                                                          **/
 /**********************************************************************************************/

 #include "state_machine.h"

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                DEFINITIONS AND MACROS                                    **/
 /**                                                                                          **/
 /**********************************************************************************************/
#define NULL 0
#define FALSE 0
#define TRUE 1

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                TYPEDEFS AND STRUCTURES                                   **/
 /**                                                                                          **/
 /**********************************************************************************************/

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                PROTOTYPES OF LOCAL FUNCTIONS                             **/
 /**                                                                                          **/
 /**********************************************************************************************/

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                EXPORTED VARIABLES                                        **/
 /**                                                                                          **/
 /**********************************************************************************************/

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                GLOBAL VARIABLES                                          **/
 /**                                                                                          **/
 /**********************************************************************************************/

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                EXPORTED FUNCTIONS                                        **/
 /**                                                                                          **/
 /**********************************************************************************************/

 void STATE_MACHINE_ejecutar(TS_MACHINE *la_maquina)
 {
	TS_STATE **Indx;    /* Valor indice rastreador */

	//if (la_maquina->StopCond())  return;

	for (Indx = la_maquina->estado; *Indx != NULL; ++Indx)
	{
		if (la_maquina->id_estado_actual == (*Indx)->id)
		{
			STATE_MACHINE_ejecuta_estado(*Indx , la_maquina);
			return;
		}
	}
 }


 void STATE_MACHINE_ejecuta_estado(TS_STATE *el_estado , TS_MACHINE *la_maquina)
 {
 	TS_EVEACC *Indx;   /* Indice de rastreo */

 	(*el_estado->controles)();

 	for (Indx = el_estado->funcion; Indx->evento != NULL; ++Indx)
 	{
 		if (Indx->evento() == TRUE)
 		{
 			if (Indx->accion != NULL)
 			{
 				Indx->accion();
 			}
 			if (Indx->id != la_maquina->id_estado_actual)
 			{
 				la_maquina->id_estado_actual = Indx->id;
 				return;
 			}

 		}
 	}
 }


 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                LOCAL FUNCTIONS                                           **/
 /**                                                                                          **/
 /**********************************************************************************************/




 //Function prolog

 /********************************************************
 *                                                       *
 * FUNCTION NAME:                                        *
 *                                                       *
 * ARGUMENTS:                                            *
 *                                                       *
 * ARGUMENT TYPE I/O DESCRIPTION                         *
 * -------- ---- --- -----------                         *
 *                                                       *
 * RETURNS:                                              *
 *                                                       *
 *********************************************************/
